# bo

<div align="center">

**仓位管理计算器**

支持标准投注、Polymarket 预测市场、股票交易、套利/抽水和纳什均衡计算的仓位管理工具

[![Release](https://img.shields.io/github/v/release/inoader/bo)](https://github.com/inoader/bo/releases/latest)
[![Build](https://img.shields.io/github/actions/workflow/status/inoader/bo/release.yml?branch=main)](https://github.com/inoader/bo/actions)

</div>

## 功能特性

- **标准模式** - 赔率 + 胜率计算凯利公式
- **Polymarket 模式** - 针对预测市场优化，直接输入市场价格和你的概率
- **股票交易模式** - 基于当前价/止盈价/止损价计算风险建议与建仓仓位
- **组合凯利模式** - 多标的联合最优仓位（独立假设）
- **套利检测** - 双边或多边套利机会计算
- **抽水分析** - 无套利时显示庄家抽水率
- **纳什均衡模式** - 2x2 双人博弈的纯策略与混合策略均衡计算
- 交互式和命令行两种使用方式
- 提供全凯利、半凯利、1/4凯利建议（含风险金额与建仓金额）
- 支持 `--json` 输出，便于脚本和自动化处理

## 安装

### 方式一：下载预编译二进制

从 [Releases](https://github.com/inoader/bo/releases) 页面下载对应平台的二进制文件：

```bash
# Linux
wget https://github.com/inoader/bo/releases/latest/download/bo-x86_64-linux
chmod +x bo-x86_64-linux
mv bo-x86_64-linux bo

# macOS (Intel)
wget https://github.com/inoader/bo/releases/latest/download/bo-x86_64-apple-darwin
chmod +x bo-x86_64-apple-darwin
mv bo-x86_64-apple-darwin bo

# macOS (Apple Silicon)
wget https://github.com/inoader/bo/releases/latest/download/bo-aarch64-apple-darwin
chmod +x bo-aarch64-apple-darwin
mv bo-aarch64-apple-darwin bo

# Windows
# 下载 bo-x86_64-windows.exe 并重命名为 bo.exe
```

### 方式二：从源码编译

```bash
git clone https://github.com/inoader/bo.git
cd bo
cargo build --release
```

二进制文件位于 `target/release/bo`。

## 使用方法

### 参数约束

- `bo -h` / `bo -help`：显示用法
- `bo -v` / `bo -version`：显示版本
- 赔率必须大于 `1.0`
- 胜率/概率必须在 `0-100` 之间
- Polymarket 市场价格必须在 `(0, 100)` 之间
- 本金、当前价、止盈价、止损价必须为正数
- 组合凯利标的数量必须在 `2-12` 之间
- 纳什模式需要 8 个收益值（`a11 a12 a21 a22 b11 b12 b21 b22`，允许负数）

### 标准模式

```bash
bo <赔率> <胜率> [本金]
bo --json <赔率> <胜率> [本金]
```

```bash
bo 2.0 60              # 赔率2.0，胜率60%
bo 2.0 60 10000        # 本金10000
```

**输出示例：**
```
──────────────────────────────────────────────────
                        计算结果
──────────────────────────────────────────────────

  输入参数:
    ├─ 赔率: 2.00
    ├─ 净赔率 (b): 1.00
    └─ 胜率 (p): 60.00%

  分析:
    ├─ 期望收益 (EV): 20.00%
    ├─ 状态: ✓ 正期望值 (值得下注)
    └─ 仓位建议: 20.00%

  基于本金 10000.00 的投注金额:
    ├─ 全凯利: 2000.00
    ├─ 半凯利: 1000.00
    └─ 1/4凯利: 500.00
```

### Polymarket 模式

```bash
bo -p <市场价格> <你的概率> [本金]
bo --json -p <市场价格> <你的概率> [本金]
```

```bash
bo -p 60 75            # 市场价格60c，你认为75%
bo -p 60 75 1000       # 本金1000
```

### 股票交易模式

```bash
bo -s <当前价> <止盈价> <止损价> <胜率> [本金]
bo --json -s <当前价> <止盈价> <止损价> <胜率> [本金]
```

```bash
bo -s 100 120 90 60            # 当前价100，止盈120，止损90，胜率60%
bo -s 100 120 90 60 10000       # 本金10000
```

**输出示例：**
```
──────────────────────────────────────────────────
                        股票交易计算结果
──────────────────────────────────────────────────

  输入参数:
    ├─ 当前价: 100.00
    ├─ 止盈价: 120.00
    ├─ 止损价: 90.00
    └─ 胜率 (p): 60.00%

  风险分析:
    ├─ 预期收益: 20.00
    ├─ 风险: 10.00
    ├─ 止损幅度: 10.00%
    └─ 盈亏比: 2.00

  分析:
    ├─ 净赔率 (b): 2.00
    ├─ 期望收益 (EV): 80.00%
    ├─ 状态: ✓ 正期望值 (值得交易)
    ├─ 风险建议: 40.00%
    └─ 建仓仓位: 400.00% (需杠杆 4.00x)

  基于本金 10000.00 的仓位金额:
    ├─ 全凯利风险金: 4000.00
    ├─ 半凯利风险金: 2000.00
    ├─ 1/4凯利风险金: 1000.00
    ├─ 全凯利建仓: 40000.00
    ├─ 半凯利建仓: 20000.00
    └─ 1/4凯利建仓: 10000.00
```

### 套利/抽水模式（双边）

```bash
bo -a <赔率1> <赔率2> [本金]
bo --json -a <赔率1> <赔率2> [本金]
```

- **隐含概率之和 < 100%** → 显示套利机会和投注方案
- **隐含概率之和 = 100%** → 无套利，抽水率为 0
- **隐含概率之和 > 100%** → 显示庄家抽水率

```bash
bo -a 2.1 2.2            # 有套利机会
bo -a 1.9 1.9            # 无套利，显示抽水
bo -a 2.1 2.2 1000       # 本金1000
```

**输出示例（有套利）：**
```
✓ 套利机会存在！
├─ 套利收益率: 2.44%
├─ 方案1投注比例: 51.22%
└─ 方案2投注比例: 48.78%

基于本金 1000.00 的投注方案:
├─ 方案1投注: 512.20
├─ 方案2投注: 487.80
└─ 获胜总回报: 1024.39 (收益: 24.39)
```

### 多标的套利/抽水模式

```bash
bo -A <标的数量> <赔率1> <赔率2> ... <赔率N> [本金]
bo --json -A <标的数量> <赔率1> <赔率2> ... <赔率N> [本金]
```

适用于多选项（如足球胜平负、多匹马赛跑等）的套利或抽水计算。

```bash
bo -A 3 2.5 4.0 5.0            # 3个标的，有套利
bo -A 3 2.0 3.5 4.0            # 3个标的，显示抽水
bo -A 3 2.5 4.0 5.0 1000       # 本金1000
```

### 纳什均衡模式（2x2）

```bash
bo -n <a11> <a12> <a21> <a22> <b11> <b12> <b21> <b22>
bo --json -n <a11> <a12> <a21> <a22> <b11> <b12> <b21> <b22>
```

其中：
- `A = [[a11, a12], [a21, a22]]` 为行玩家收益矩阵
- `B = [[b11, b12], [b21, b22]]` 为列玩家收益矩阵

```bash
bo -n 3 0 5 1 3 5 0 1          # 囚徒困境
bo -n 1 -1 -1 1 -1 1 1 -1      # Matching Pennies
```

### 组合凯利模式

```bash
bo -k <标的数量> <赔率1> <胜率1> ... <赔率N> <胜率N> [本金]
bo --json -k <标的数量> <赔率1> <胜率1> ... <赔率N> <胜率N> [本金]
bo -k <descriptor1> <descriptor2> ... [本金]
bo --json -k <descriptor1> <descriptor2> ... [本金]
```

适用于同时配置多个独立策略腿（标准/Polymarket/股票/套利）的联合仓位优化。

`descriptor` 支持以下格式：

- `std:赔率:胜率`（标准模式，胜率单位为 `%`）
- `pm:市场价格:你的概率`（Polymarket，价格与概率单位为 `%`）
- `stock:当前价:止盈价:止损价:胜率`（股票模式）
- `arb:赔率1:赔率2`（双边套利腿，按确定性收益/抽水建模）
- `marb:赔率1,赔率2,...`（多边套利腿，按确定性收益/抽水建模）

```bash
bo -k 2 2.0 60 2.5 55
bo -k 2 2.0 60 2.5 55 10000
bo -k std:2.0:60 pm:60:75 stock:100:120:90:60 10000
bo --json -k std:2.0:60 arb:2.1:2.2 marb:2.5,4.0,5.0 10000
```

### 交互式模式

不带参数或仅带模式标志即可进入交互式模式：

```bash
bo              # 标准模式交互
bo -p           # Polymarket 交互
bo -s           # 股票交易交互
bo -a           # 套利交互
bo -A           # 多标的套利交互
bo -n           # 纳什均衡交互
bo -k           # 组合凯利交互
```

`--json` 仅适用于命令行参数模式，不支持交互式模式。

## 公式说明

### 凯利公式

```
f* = (bp - q) / b
```

- `b` = 净赔率（赔率 - 1）
- `p` = 胜率
- `q` = 败率（1 - p）
- `f*` = 最优仓位比例

### Polymarket 变体

```
隐含赔率 = (1 - 市场价格) / 市场价格
f* = (隐含赔率 × 你的概率 - (1 - 你的概率)) / 隐含赔率
```

### 套利检测

```
隐含概率 = 1 / 赔率
套利条件: Σ隐含概率 < 100%
套利收益率 = (1 / Σ隐含概率) - 1

双边投注比例:
方案1投注比例 = 赔率2 / (赔率1 + 赔率2)
方案2投注比例 = 赔率1 / (赔率1 + 赔率2)

多边投注比例:
标的i投注比例 = (1 / 赔率i) / Σ隐含概率
```

### 纳什均衡（2x2）

设行玩家收益矩阵 `A`、列玩家收益矩阵 `B`：

```
A = [[a11, a12], [a21, a22]]
B = [[b11, b12], [b21, b22]]
```

内部混合策略均衡（若存在）满足双方无差异：

```
q = (a22 - a12) / (a11 - a12 - a21 + a22)
p = (b22 - b21) / (b11 - b21 - b12 + b22)
```

- `p`：行玩家选择“上”策略的概率
- `q`：列玩家选择“左”策略的概率
